#include <Gamebuino-Meta.h>

#define MENU_MODE 1
#define MAP_MODE 2
#define BATTLE_MODE 3
#define BASE_MODE 4
#define MULTIPLAYER_SCENARIO_MODE 5
#define CAMPAIGN_SCENARIO_MODE 6

struct GameTileStruct
{
    unsigned int terrainTexture: 7;
    unsigned int player: 3;
    unsigned int unitId: 5;
    unsigned int unitHp: 4;
    unsigned int active: 1;
    unsigned int moveGrid: 3;
    unsigned int playerBuilding: 3;
    unsigned int keyUnit: 1;
    unsigned int keyTile: 1;
    unsigned int reserve: 4;
};

struct Unit
{
  unsigned int unitId: 5;
  unsigned int movement: 3;
  unsigned int crossMove: 1;
  unsigned int canCrossMountains: 1;
  unsigned int attackRange: 3;
  unsigned int reserve: 19;
};

struct Player
{
  unsigned int id;
  unsigned int baseLevel;
  int funds; 
  unsigned int totalUnits;
};

struct TileCoords
{
  unsigned int row: 17;
  unsigned int column: 17;
};

const Unit NONE = {0,0,0,0,0};
const Unit HALF_TRUCK = {1,4,0,0,1};
const Unit MEDIUM_TANK = {2,3,0,0,1};
const Unit HEAVY_TANK = {3,3,0,0,1};
const Unit TANK_DESTROYER = {4,3,0,0,1};
const Unit MOBILE_ARTILLERY = {5,4,1,0,2};
const Unit MOBILE_SSM = {6,3,1,0,3};
const Unit INFANTRY = {7,2,0,1,1};
const Unit MECH_INFANTRY = {8,1,0,1,1};

GameTileStruct Board1[16][16]
{
  {{0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0},{14,1,2,10,1,0,0,0,0},{1,0,0,0,0,0,0,0,0},{4,2,7,10,1,0,0,0,0},{1,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{19,0,0,0,0,0,0,0,0},{15,0,0,0,0,0,0,0,0},{17,0,0,0,0,0,0,0,0},{4,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0}},
  {{16,0,0,0,0,0,0,0,0},{16,0,0,0,0,0,0,0,0},{18,1,4,10,1,0,0,0,0},{11,0,0,0,0,0,1,0,0},{4,2,8,10,1,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{13,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0},{14,0,0,0,0,0,0,0,0},{4,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{12,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0}},
  {{1,0,0,0,0,0,0,0,0},{1,1,5,10,1,0,0,0,0},{1,1,7,10,1,0,0,0,0},{1,0,0,0,0,0,0,0,0},{4,2,1,10,1,0,0,0,0},{1,2,5,10,1,0,0,0,0},{10,0,0,0,0,0,0,0,0},{12,0,0,0,0,0,0,0,0},{20,0,0,0,0,0,0,0,0},{16,0,0,0,0,0,0,0,0},{18,0,0,0,0,0,0,0,0},{4,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0}},
  {{25,0,0,0,0,0,1,0,0},{7,1,6,10,1,0,0,0,0},{3,1,8,10,1,0,0,0,0},{3,0,0,0,0,0,0,0,0},{5,2,2,10,1,0,0,0,0},{3,2,6,10,1,0,0,0,0},{3,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{8,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0}},
  {{3,0,0,0,0,0,0,0,0},{8,1,1,10,1,0,0,0,0},{1,1,3,10,1,0,0,0,0},{10,0,0,0,0,0,0,0,0},{4,2,3,10,1,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0}},
  {{2,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{4,2,4,10,1,0,0,0,0},{1,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{12,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0}},
  {{10,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{26,0,0,0,0,0,0,0,0},{5,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{6,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{7,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{6,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0}},
  {{10,0,0,0,0,0,0,0,0},{12,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{4,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{12,0,0,0,0,0,0,0,0},{4,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{4,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{12,0,0,0,0,0,0,0,0},{4,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0}},
  {{10,0,0,0,0,0,0,0,0},{19,0,0,0,0,0,0,0,0},{15,0,0,0,0,0,0,0,0},{15,0,0,0,0,0,0,0,0},{29,0,0,0,0,0,0,0,0},{15,0,0,0,0,0,0,0,0},{17,0,0,0,0,0,0,0,0},{4,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{4,0,0,0,0,0,0,0,0},{12,0,0,0,0,0,0,0,0},{7,0,0,0,0,0,0,0,0},{8,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0}},
  {{10,0,0,0,0,0,0,0,0},{13,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0},{29,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0},{14,0,0,0,0,0,0,0,0},{9,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{5,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{8,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0}},
  {{2,0,0,0,0,0,0,0,0},{20,0,0,0,0,0,0,0,0},{21,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0},{29,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0},{14,0,0,0,0,0,0,0,0},{12,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{4,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0}},
  {{2,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{20,0,0,0,0,0,0,0,0},{16,0,0,0,0,0,0,0,0},{29,0,0,0,0,0,0,0,0},{16,0,0,0,0,0,0,0,0},{18,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{4,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0}},
  {{12,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{4,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{4,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,2,7,10,1,0,0,0,0},{1,0,0,0,0,0,0,0,0},{25,0,0,0,0,0,2,0,0}},
  {{10,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{26,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{8,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{12,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{9,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0},{3,0,0,0,0,0,0,0,0}},
  {{1,0,0,0,0,0,0,0,0},{12,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{2,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{11,0,0,0,0,0,2,0,0},{1,0,0,0,0,0,0,0,0},{1,2,1,10,1,0,0,0,0},{1,0,0,0,0,0,0,0,0}},
  {{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{12,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0},{19,0,0,0,0,0,0,0,0},{15,0,0,0,0,0,0,0,0},{15,0,0,0,0,0,0,0,0},{17,0,0,0,0,0,0,0,0},{1,0,0,0,0,0,0,0,0},{10,0,0,0,0,0,0,0,0}},
};

GameTileStruct CurrentBoard[16][16];

bool menuMode=false;

int SceneMode=MENU_MODE;

Player Player_1={1,1,0,0};
Player Player_2={2,1,0,0};

GameTileStruct Attacker={12,1,7,10,0,0};
GameTileStruct Defender={12,2,7,10,0,0};

TileCoords BaseLocation={0,0};
TileCoords AttackerLocation={0,0};
TileCoords DefenderLocation={0,0};

Player CurrentPlayer = Player_1;

void setup() {
  gb.begin();
}    


void loop() {
  while(!gb.update());
  gb.display.clear();
  if(SceneMode==MENU_MODE)
  {
    MainMenuScene();
  }
  else if(SceneMode==MULTIPLAYER_SCENARIO_MODE)
  {
    MultiplayerScenarioScene();
  }
  else if(SceneMode==MAP_MODE)
  {
    if(menuMode==true)
    {
      memcpy(CurrentBoard, Board1, sizeof(CurrentBoard));
      menuMode=false;
    }
    
    BattleMap();
  }
  else if(SceneMode==BATTLE_MODE)
  {
    BattleScene();
  }
  else //Base mode
  {
    BaseScene();
  }
}
